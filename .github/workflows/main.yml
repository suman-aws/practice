name: My Workflow

on: push

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Extract variables
      run: |
        output=$(python prepare_new_deployment.py)

        environment=$(echo "$output" | grep 'ENVironment:' | awk '{print $2}' | tr -d '[],')
        deployment_context=$(echo "$output" | grep 'DEPLOYMENT_CONTEXT:' | awk '{print $2}' | tr -d '[],')
        model_names=$(echo "$output" | grep 'MODEL_NAMES:' | awk '{print $2}' | tr -d '[],')
        model_versions=$(echo "$output" | grep 'MODEL_VERSIONS:' | awk '{print $2}' | tr -d '[],')
        system_uids=$(echo "$output" | grep 'SYSTEM_UIDS:' | awk '{print $2}' | tr -d '[],')
        testing_times=$(echo "$output" | grep 'TESTING_TIMES:' | awk '{print $2}' | tr -d '[],')

        echo "ENVIRONMENT=$environment" >> $GITHUB_ENV
        echo "DEPLOYMENT_CONTEXT=$deployment_context" >> $GITHUB_ENV
        echo "MODEL_NAMES=$model_names" >> $GITHUB_ENV
        echo "MODEL_VERSIONS=$model_versions" >> $GITHUB_ENV
        echo "SYSTEM_UIDS=$system_uids" >> $GITHUB_ENV
        echo "TESTING_TIMES=$testing_times" >> $GITHUB_ENV
    - name: Display environment variables
      run: |
        echo "ENVIRONMENT=${{ env.ENVIRONMENT }}"
        echo "DEPLOYMENT_CONTEXT=${{ env.DEPLOYMENT_CONTEXT }}"
        echo "MODEL_NAMES=${{ env.MODEL_NAMES }}"
        echo "MODEL_VERSIONS=${{ env.MODEL_VERSIONS }}"
        echo "SYSTEM_UIDS=${{ env.SYSTEM_UIDS }}"
        echo "TESTING_TIMES=${{ env.TESTING_TIMES }}"

    # - name: Use the outputs
    #   run: |
    #     echo "environment: ${{ steps.build.outputs.environment }}"
    #     echo "deployment_context: ${{ steps.build.outputs.deployment_context }}"
    #     echo "model_names: ${{ steps.build.outputs.model_names }}"
    #     echo "model_versions: ${{ steps.build.outputs.model_versions }}"
    #     echo "system_uids: ${{ steps.build.outputs.system_uids }}"
    #     echo "testing_times: ${{ steps.build.outputs.testing_times }}"
